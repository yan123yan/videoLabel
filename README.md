# 🎬 视频标注应用

一个基于 Streamlit 的智能化视频标注与分析工具，专门用于驾驶行为视频的标注工作。

## 📋 目录
- [功能特性](#功能特性)
- [安装指南](#安装指南)
- [使用说明](#使用说明)
- [标注规范](#标注规范)
- [文件结构](#文件结构)
- [常见问题](#常见问题)

## ✨ 功能特性

### 🎥 视频管理
- **多格式支持**: 支持 .mp4, .avi, .mov, .mkv, .wmv, .flv, .webm, .m4v 等主流视频格式
- **文件夹浏览**: 自动扫描指定路径下的所有视频文件，按文件夹分组显示
- **历史路径**: 自动保存最近使用的文件夹路径，快速切换项目
- **收藏功能**: 标记重要视频文件，方便后续查找

### 📝 标注功能
- **必填标注项**: 5个核心标注字段，确保数据完整性
- **可选详细描述**: 4个详细描述字段，支持深度分析
- **实时保存**: 标注内容自动保存，防止数据丢失
- **断点续标**: 支持暂停后继续标注，保持工作进度

### 📊 进度管理
- **整体进度**: 显示项目总体完成情况
- **文件夹进度**: 每个文件夹的标注进度统计
- **状态跟踪**: 实时更新标注状态

## 🚀 安装指南

### 环境要求
- Python 3.7+
- 支持的操作系统: Windows, macOS, Linux

### 安装步骤

1. **克隆项目**
   ```bash
   git clone <项目地址>
   cd videoLabel
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **运行应用**
   ```bash
   streamlit run app.py
   ```

4. **访问应用**
   - 在浏览器中打开 `http://localhost:8503`
   - 应用将自动启动并显示主界面

## 📖 使用说明

### 1. 初始设置

#### 选择视频文件夹
- 在左侧边栏的"📁 项目配置"区域
- 输入包含视频文件的文件夹路径
- 点击"✅ 确认路径"按钮加载项目

#### 使用历史路径
- 如果之前使用过应用，可以从"📋 历史路径"下拉菜单中选择
- 点击"🔄 加载选中路径"快速加载项目

### 2. 视频选择

#### 选择文件夹
- 在右侧标注区域，从"选择文件夹"下拉菜单中选择目标文件夹
- 显示格式：`文件夹名 (X 个视频)`

#### 选择视频文件
- 从"选择视频"下拉菜单中选择要标注的视频
- ⭐ 标记表示该视频已被收藏

### 3. 视频播放

- 选择视频后，左侧将显示视频播放器
- 支持播放、暂停、快进、快退等基本控制
- 可以随时调整播放进度进行精确标注

### 4. 标注操作

#### 收藏管理
- 🤍 **收藏**: 点击添加到收藏列表
- ❤️ **取消收藏**: 点击从收藏列表移除

#### 必须标注项 ⭐
以下字段为必填项，确保每个视频都要完成：

1. **自动驾驶模式 (autonomous_mode)**
   - 输入格式: `0`, `1`, `01`, `10`
   - `0`: 关闭自动驾驶
   - `1`: 开启自动驾驶  
   - `01`: 先关闭后开启
   - `10`: 先开启后关闭

2. **驾驶操控风格 (driving_control_style)**
   - 多选字段，最多选择 3 项
   - 选项包括：过度谨慎驾驶、谨慎驾驶、平稳驾驶、激进驾驶等

3. **视觉注意风格 (visual_attention_style)**
   - 多选字段，最多选择 3 项
   - 选项包括：专注前方、观察四周、关注行人、查看后视等

4. **综合风格 (integrated_style)**
   - 多选字段，最多选择 3 项
   - 选项包括：谨慎、稳定、激进、粗心、分心、专注

5. **建议 (suggestion)**
   - 多选字段，最多选择 3 项
   - 选项包括：减速、变道、观察行人、手动驾驶等

#### 详细描述 (可选) 📝
每个文件夹至少需要完成 5 个视频的详细描述：

1. **场景描述 (SceneDescription)**
   - 描述视频中的道路环境、天气条件、交通状况等

2. **驾驶员注意力 (Driver's Attention)**
   - 观察并记录驾驶员的注意力分布和行为特征

3. **人机交互 (Human-Machine Interaction)**
   - 记录驾驶员与车载系统的交互情况

4. **评估与建议 (Evaluation & Suggestions)**
   - 对驾驶行为进行评估并提出改进建议

### 5. 数据保存

- **自动保存**: 每次修改标注内容后会自动保存
- **保存格式**: 标注数据保存为与视频同名的 .txt 文件
- **保存位置**: 与视频文件在同一目录下

## 📋 标注规范

### 标注原则
1. **准确性**: 仔细观察视频内容，确保标注准确
2. **一致性**: 同类行为使用统一的标注标准
3. **完整性**: 必填字段必须完成，可选字段按要求完成

### 标注质量要求
- **必填项**: 每个视频都必须完成所有必填标注项
- **详细描述**: 每个文件夹至少完成 5 个视频的详细描述
- **收藏标记**: 对重要或典型案例进行收藏标记

### 数据文件格式
标注数据保存为 txt 格式，示例：
```
autonomous_mode: 1
driving_control_style: 平稳驾驶, 谨慎驾驶
visual_attention_style: 专注前方, 观察四周
integrated_style: 稳定, 谨慎
suggestions: 继续保持, 关注周围交通

-------------------------

**Scene Description:**
城市道路，天气晴朗，交通正常...

**Driver's Attention:**
驾驶员注意力集中，经常查看后视镜...

**Human-Machine Interaction:**
驾驶员与导航系统交互良好...

**Evaluation & Suggestions:**
整体驾驶表现良好，建议...
```

## 📁 文件结构

```
videoLabel/
├── app.py                      # 主应用入口
├── requirements.txt            # 项目依赖
├── README.md                   # 使用说明
├── PLAN.md                     # 技术方案
├── .streamlit/
│   └── config.toml            # Streamlit 配置
├── modules/                    # 功能模块
│   ├── __init__.py
│   ├── file_manager.py        # 文件管理
│   ├── video_player.py        # 视频播放
│   ├── annotation_form.py     # 标注表单
│   ├── data_storage.py        # 数据存储
│   ├── progress_manager.py    # 进度管理
│   ├── history_manager.py     # 历史管理
│   └── favorites_manager.py   # 收藏管理
├── config/                     # 配置文件
│   ├── __init__.py
│   └── word_bank.py           # 词组库配置
└── data/                       # 数据存储
    ├── favorites.json         # 收藏列表
    └── path_history.json      # 路径历史
```

## ❓ 常见问题

### Q: 应用无法启动怎么办？
A: 
1. 检查 Python 版本是否为 3.7+
2. 确认已安装所有依赖：`pip install -r requirements.txt`
3. 检查端口 8503 是否被占用

### Q: 视频无法播放怎么办？
A:
1. 确认视频格式是否支持（支持 mp4, avi, mov 等主流格式）
2. 检查视频文件是否损坏
3. 确认文件路径是否正确

### Q: 标注数据在哪里保存？
A: 标注数据保存在与视频文件同一目录下，文件名为 `视频名.txt`

### Q: 如何批量导出标注数据？
A: 可以编写脚本扫描文件夹中的所有 .txt 文件进行数据汇总

### Q: 如何重置应用状态？
A: 点击左侧边栏的"🔄 重置"按钮可以清空当前状态

### Q: 历史路径记录太多怎么办？
A: 点击"🗑️ 清空历史记录"按钮可以清除所有历史路径

## 🔧 技术支持

如果在使用过程中遇到问题：
1. 检查控制台是否有错误信息
2. 确认输入的路径和格式是否正确
3. 重启应用重试

---

**© 2025 视频标注应用 - 让视频标注更简单、更高效！**